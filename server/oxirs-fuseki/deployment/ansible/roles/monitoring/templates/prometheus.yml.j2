# Prometheus Configuration for OxiRS Fuseki
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

global:
  scrape_interval: {{ prometheus_scrape_interval }}
  evaluation_interval: {{ prometheus_evaluation_interval }}
  external_labels:
    cluster: '{{ environment }}'
    region: '{{ datacenter | default("unknown") }}'

scrape_configs:
  # OxiRS Fuseki servers
  - job_name: 'oxirs-fuseki'
    static_configs:
{% for host in groups['fuseki_servers'] %}
      - targets: ['{{ hostvars[host].ansible_default_ipv4.address }}:{{ oxirs_http_port }}']
        labels:
          instance: '{{ host }}'
          environment: '{{ environment }}'
{% endfor %}
    metrics_path: '/metrics'
    scrape_interval: 15s

  # Node Exporter (system metrics)
  - job_name: 'node-exporter'
    static_configs:
{% for host in groups['fuseki_servers'] %}
      - targets: ['{{ hostvars[host].ansible_default_ipv4.address }}:9100']
        labels:
          instance: '{{ host }}'
          environment: '{{ environment }}'
{% endfor %}
    scrape_interval: 30s

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
